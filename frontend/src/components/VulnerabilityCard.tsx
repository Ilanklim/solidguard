import { Badge } from "@/components/ui/badge";
import { AlertTriangle, FileCode, Info } from "lucide-react";

interface Attack {
  type: string;
  severity: "low" | "medium" | "high";
  lines: number[];
  description: string;
  refs: string[] | null;
}

interface VulnerabilityCardProps {
  attack: Attack;
  index: number;
}

const severityIcons = {
  high: AlertTriangle,
  medium: AlertTriangle,
  low: Info,
};

const categoryLabels: Record<string, string> = {
  access_control: "Access Control",
  arithmetic: "Arithmetic",
  denial_of_service: "Denial of Service",
  front_running: "Front Running",
  initialization: "Initialization",
  reentrancy: "Reentrancy",
  signature_verification: "Signature Verification",
  unchecked_return_value: "Unchecked Return",
  unencrypted_private_data: "Unencrypted Data",
  unprotected_self_destruct: "Self Destruct",
};

export function VulnerabilityCard({ attack, index }: VulnerabilityCardProps) {
  const Icon = severityIcons[attack.severity];

  return (
    <div
      className="group rounded-lg border border-border bg-card p-3 transition-all hover:border-primary/50 hover:shadow-md hover:shadow-primary/5 card-shadow"
      style={{ animationDelay: `${index * 100}ms` }}
    >
      <div className="flex items-start justify-between gap-2 mb-3">
        <div className="flex items-start gap-2">
          <div
            className={`flex h-8 w-8 items-center justify-center rounded-md flex-shrink-0 ${
              attack.severity === "high"
                ? "bg-severity-high/20 text-severity-high"
                : attack.severity === "medium"
                ? "bg-severity-medium/20 text-severity-medium"
                : "bg-severity-low/20 text-severity-low"
            }`}
          >
            <Icon className="h-4 w-4" />
          </div>
          <div className="min-w-0">
            <h3 className="font-semibold text-sm text-foreground truncate">
              {categoryLabels[attack.type] || attack.type}
            </h3>
            <Badge variant={attack.severity} className="uppercase text-xs px-1.5 py-0">
              {attack.severity}
            </Badge>
          </div>
        </div>
      </div>

      <p className="text-xs text-muted-foreground leading-relaxed mb-3">
        {attack.description}
      </p>

      <div className="flex flex-col gap-1 text-xs">
        <div className="flex items-center gap-2 text-muted-foreground">
          <FileCode className="h-3.5 w-3.5" />
          <span>
            Lines:{" "}
            <span className="text-primary font-mono font-medium">
              {attack.lines.join(", ")}
            </span>
          </span>
        </div>

        {attack.refs && attack.refs.length > 0 && (
          <div className="flex items-start gap-2 text-muted-foreground">
            <span className="flex-shrink-0">Refs:</span>
            <span className="text-primary font-mono text-xs break-all">
              {attack.refs.map(ref => ref.replace(/[\*:]/g, '').trim()).filter(ref => ref.length > 0).join(", ")}
            </span>
          </div>
        )}
      </div>
    </div>
  );
}
